<!DOCTYPE html>
<html>
  <head>
    <title>PingdomGames</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>
    <h1 style="font-style:italic">
      <div class="title">
        <%= image_tag("logos/transparent_logo.png", width: '100px') %>
        Pingdom Games
      </div>
    </h1>

    <!--<%= debug cart %>-->
    <p class="alert"><%= alert %></p>

    <ul>
      <% if user_signed_in? %>
        <li><%= link_to "Hi, #{current_user.user_name}", users_show_path %></li>
        <li><%= link_to 'Sign Out', destroy_user_session_path, method: :delete %></li>
      <% else %>
        <li><%= link_to 'Sign In', new_user_session_path %></li>
        <li><%= link_to 'Sign Up', new_user_registration_path %></li>
      <% end %>
    </ul>

    <details>
      <summary>
          <%= link_to image_tag("cart.jpg", width:60), cart_show_path %>
          Cart
          <% if cart.present? %>
            <sup><%= cart.size %></sup>
          <% end %>
      </summary>
      <% if cart.present? %>
        <ul>
          <% cart.each do |product| %>
            <li>
              <%= session[:shopping_cart]["#{product.id}"] %> X <%= link_to product.name, product %> <%= link_to '❌', cart_path(product), method: :delete %>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p>No items in your cart.</p>
      <% end %>
    </details>

    <nav>
      <%= link_to 'Games', products_path %>
      <%= link_to 'Consoles', platforms_path %>
      <%= link_to 'Genres', genres_path %>
      <%= link_to 'Publishers', publishers_path %>

      <div id="Search_Form">
        <%= form_with(url: products_path, method: :get, local: true) do %>
        <%= text_field_tag(:keywords, nil, class: "input", placeholder: "Search for Games") %>
        <%= select_tag 'platform', options_for_select(["Console"] + Platform.all.map{|p| [p.name, p.id]}) %>
        <%= submit_tag("Search", class: "button is-primary") %>
        <% end %>
      </div>
    </nav>
    <hr>

    <% if flash[:notice] && !current_page?('/cart/show') %>
      <p><%= flash[:notice][0] %></p>
      <hr>
    <% end %>
    <%= yield %>
  </body>
</html>
